<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SRA Submission &mdash; Homepage</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.9',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Homepage" href="index.html" />
    <link rel="up" title="QIIME Documentation" href="documentation.html" />
    <link rel="next" title="Report and fixing bugs" href="developer/reporting_and_fixing_bugs.html" />
    <link rel="prev" title="Special-Purpose Tutorials" href="doc_special_purpose.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 0px">
<a href="index.html"><img src="_static/wordpressheader.png" border="0" alt="sampledoc"/></a>
</div>
<div class="news" style="background-color:#ccc;">
	<p style="font-size:12pt;padding: 5px;"><b>News and Announcements &raquo;</b>
<script type="text/javascript" src="http://app.feed.informer.com/digest3/U9OLMKHF9N.js"><noscript><a href="http://app.feed.informer.com/digest3/U9OLMKHF9N.html">Click for &quot;QIIME&quot;.</a> Powered by <a href="http://feed.informer.com/">RSS Feed Informer</a></noscript></script></p>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="developer/reporting_and_fixing_bugs.html" title="Report and fixing bugs"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="doc_special_purpose.html" title="Special-Purpose Tutorials"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Home</a> &raquo;</li>
          <li><a href="documentation.html" accesskey="U">QIIME Documentation</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <ul class="simple">
</ul>
<div class="section" id="sra-submission">
<span id="index-80"></span><h1>SRA Submission<a class="headerlink" href="#sra-submission" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This Tutorial provides an overview of the SRA submission preparation procedure, using as an example the data from the Fierer et al. 2008 hand dataset. The SRA submission example shown here, is from the first barcoded SRA submission, accession #: <a class="reference external" href="http://www.ncbi.nlm.nih.gov/sites/entrez?db=sra&amp;term=SRS001216">SRS001216</a>. It outlines the same two-stage procedure we will use for submitting the Human Microbiome Project (HMP) data to SRA. This draft is intended to be passed on to the Data Analysis and Coordination Center (DACC) for further editing and revision with guidance from the centers.</p>
<p>The data shown in this tutorial can be downloaded from: <a class="reference external" href="http://tajmahal.colorado.edu/tmp/knight_handstudy_demo.zip">SRA Tutorial Data</a></p>
</div>
<div class="section" id="philosophy-of-this-document-and-the-accompanying-code">
<h2>Philosophy of this Document and the Accompanying Code<a class="headerlink" href="#philosophy-of-this-document-and-the-accompanying-code" title="Permalink to this headline">¶</a></h2>
<p>This document and code does not seek to capture the full complexity of what is possible in the SRA. Instead, the goal is to provide a simple pathway for submission to the SRA of the most common types of data. For example, more normalization could be provided through requiring additional tables, but this additional complexity is not justified when the appropriate rows can be copied/pasted/updated in Excel in a few seconds. More flexibility and better normalization is certainly possible and may be supported in future: the focus here is on getting something that works now.</p>
<p>Originally, the plan was to do this as a series of standalone scripts, but this ended up with an unacceptable level of reimplementation of things that are already in QIIME (&#8220;Quantitative Insights Into Microbial Ecology&#8221;, our 454 analysis package). We have therefore contributed the code into QIIME. You can get this package from sourceforge here:</p>
<p><a class="reference external" href="http://sourceforge.net/projects/qiime/">http://sourceforge.net/projects/qiime/</a></p>
<p>You will need several other packages to complete this analysis:</p>
<blockquote>
<ul class="simple">
<li><a class="reference external" href="http://blast.ncbi.nlm.nih.gov/Blast.cgi?CMD=Web&amp;PAGE_TYPE=BlastDocs&amp;DOC_TYPE=Download">BLAST</a></li>
<li><a class="reference external" href="http://www.bioinformatics.org/cd-hit/">cdhit</a></li>
<li><a class="reference external" href="http://sourceforge.net/projects/pycogent/">pycogent</a></li>
<li><a class="reference external" href="http://numpy.scipy.org/">numpy</a></li>
<li><a class="reference external" href="http://matplotlib.sourceforge.net/">matplotlib</a> (required for pycogent but not used here)</li>
<li><a class="reference external" href="http://www.python.org/download/">python</a></li>
</ul>
</blockquote>
<p>The PyCogent install guide is fairly helpful in showing you the dependencies and how to get them; the QIIME install guide has some information about installing the 3rd-party applications it wraps. Note that some of the unit tests will fail if you don&#8217;t install all the applications but the subset of the analysis shown here should work (e.g. you won&#8217;t be able to do sequence alignment or taxonomy assignment without additional work).</p>
</div>
<div class="section" id="overview-of-the-submission-process">
<h2>Overview of the Submission Process<a class="headerlink" href="#overview-of-the-submission-process" title="Permalink to this headline">¶</a></h2>
<p>An SRA submission can consist of metadata only, or of metadata together with sequence data. The SRA has recently added support for submission of barcoded pyrosequencing runs. This document describes how to prepare such submissions in a two-stage process:</p>
<blockquote>
<ol class="arabic simple">
<li>Submission of the study and sample metadata, including clinical metadata (this will be performed by the DACC).</li>
<li>Submission of the experiment and run data, and associated technical metadata (this is expected to be performed by the DACC for the pilot, although there is no technical barrier to having it performed by the Centers). It is, at this point, expected that the Centers will submit their own data after the pilot phase, although there are also arguments for submission through the DACC for consistency of QA processes.</li>
</ol>
</blockquote>
<p>Updates are handled by regenerating the submission xml files (and optionally the .sff files), at which point they will be reloaded into the SRA. The current pipeline does not provide a mechanism for doing partial updates (e.g. adding an experiment or a run to an existing submission) &#8211; all the metadata and/or data for the submission must be replaced with clean files. It may be possible in the future to allow incremental submissions but this is not presently supported. Questions about the Submission Process</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Q1. Can I submit multiplexed pyrosequnecing runs now?</p>
<p>A1. Yes.</p>
<p>Q2. Can I combine mock and clinical samples on the same 454 plate? (or, more generally, can I combine samples from different studies on the same 454 plate?)</p>
<p>A2. Yes, but you must specify in the <tt class="docutils literal"><span class="pre">library.txt</span></tt> input file which samples go with which study.</p>
<p>Q3. Can I associate the same sample (and thus reads) with more than one study?</p>
<p>A3. No.</p>
<p>Q4. Can I combine samples that use different primers on the same run?</p>
<p>A4. Yes, but you must specify in the <tt class="docutils literal"><span class="pre">library.txt</span></tt> input file which primer was used for each &#8220;member&#8221; of the pooled library.</p>
<p>Q5. Who will submit what?</p>
<p>A5. At this stage, we expect the DACC to submit both the sample/study metadata and the experiment/library metadata and sequence data for the pilot. Later, the Centers will have the capacity to submit their own data. Centers will be credited with their data appropriately regardless of the mechanism by which the submission is actually performed. The submission will be a two-stage process: (1) the creation of study and sample records by the DACC, (2) the submission of sequence data and associated metadata by the DACC and/ or the Centers.</p>
<p>Q6. Can I associate the same sample with more than one barcode and/or primer?</p>
<p>A6. Yes, but you must specify a unique identifier for each &#8220;member&#8221; of the pool that associates the sample, primer and barcode.</p>
<p>Q7. What is the distinction between a STUDY, an EXPERIMENT, and a RUN?</p>
<p>A7. As SRA uses the terms, a STUDY is a collection of EXPERIMENTS. An EXPERIMENT is a LIBRARY (potentially a library of many samples that form a POOL, if multiplexing was used &#8211; each MEMBER of a pool is associated with a sample, a primer, and a barcode) that was sequenced using one or more instrument runs. A RUN is the sequencing of a particular MEMBER of a pooled library on a particular instrument at a particular time. Thus, a single instrument run gives rise to many RUN entries in SRA.</p>
<p>Q8. Is there an intermediate level between STUDY and EXPERIMENT?</p>
<p>A8. Not for practical purposes. SRA will eventually allow a hierarchy of STUDY entries but this is not yet implemented.</p>
<p>Q9. Do I really have to make a separate sff file for every MEMBER of every POOL for every instrument run?</p>
<p>A9. Yes, and you also have to reset the quality trimming to correspond to the primer that was used for that particular member. The SRA will, in future, provide the demultiplexing service, but for now requires that the submissions be demultiplexed in advance. Fortunately, the accompanying scripts assist with this process.</p>
<p>Q10. Is it OK for primers to be different lengths on the same 454 run?</p>
<p>A10. Yes, but not within the same MEMBER of a library (i.e. if you have primers of different lengths, the different lengths are considered different MEMBER entries and should be marked as such in <tt class="docutils literal"><span class="pre">library.txt</span></tt>).</p>
<p>Q11. How should degenerate primers be handled?</p>
<p class="last">A11. All possible sequences that match the degenerate primer should be allowed using the EXPECTED_BASECALL_TABLE mechanism in <tt class="docutils literal"><span class="pre">experiment.xml</span></tt> (see example).</p>
</div>
<p>What files and information are needed to prepare a submission?</p>
<p>A submission consists of a <tt class="docutils literal"><span class="pre">submission.xml</span></tt>, metadata file, which references other xml metadata files and optionally tarballs of sequence data files, as follows:</p>
<ol class="arabic">
<li><p class="first">Submission of Study and Sample Metadata.</p>
<blockquote>
<dl class="docutils">
<dt>Input:</dt>
<dd><ol class="first last loweralpha simple">
<li><tt class="docutils literal"><span class="pre">study.txt</span></tt> - tabular metadata about the study (this is used to accession the study).</li>
<li><tt class="docutils literal"><span class="pre">sample.txt</span></tt> - tabular metadata about each sample (this is used to accession samples).</li>
<li><tt class="docutils literal"><span class="pre">study_template.xml</span></tt> - xml tempate for study data (located in Qiime/support_files/sra_xml_templates/ directory)</li>
<li><tt class="docutils literal"><span class="pre">sample_template.xml</span></tt> - xml template for sample data (located in Qiime/support_files/sra_xml_templates/ directory)</li>
<li><tt class="docutils literal"><span class="pre">submission_template.xml</span></tt> - xml template for submission (located in Qiime/support_files/sra_xml_templates/ directory)</li>
</ol>
</dd>
<dt>Output:</dt>
<dd><ol class="first last loweralpha simple">
<li><tt class="docutils literal"><span class="pre">study.xml</span></tt> - xml-format metadata about the study.</li>
<li><tt class="docutils literal"><span class="pre">sample.xml</span></tt> - xml-format metadata about each sample</li>
<li><tt class="docutils literal"><span class="pre">submission.xml</span></tt> - xml-format metadata about the study and sample submission</li>
</ol>
</dd>
</dl>
</blockquote>
</li>
</ol>
<p>NOTE: There will be two STUDY entries associated with the pilot: HMP_PILOT_CLINICAL for the clinical data, and HMP_PILOT_MOCK for the mock community data. There will be additional STUDY entries associated with the demonstration projects, in the namespace HMP_DEMO_X where X is the name of the demonstration project (the DACC will help demonstration projects submit their data using the process described in this document, and/or provide the relevant scripts to the demonstration projects). The SRA STUDY concept is intended to map more or less onto a paper, but the SRA EXPERIMENT concept maps onto a library: there will in the future be a way of associating SRA STUDY entries with each other in a hierarchical way but it does not yet exist. The initial mechanism is that SRA will provide a web page indexing all the HMP STUDY entries as a portal.</p>
<p>NOTE: It is VERY IMPORTANT that the centers do not make up new accessions or include samples that have not been accessioned by the DACC in their HMP submissions. This will cause load problems, failed submissions, etc. The recommendation is to separate out the HMP from the non-HMP data when a run contains both, and to do independent submissions (they will be matched up to the same run via the run name attribute in SRA).</p>
<p>Example:</p>
<div class="highlight-python"><pre>make_sra_submission.py -a sample.txt -t study.txt -u submission.txt --template_study_fp ~/Qiime/support_files/sra_xml_templates/study_template.xml --template_sample_fp ~/Qiime/support_files/sra_xml_templates/sample_template.xml --template_submission_fp ~/Qiime/support_files/sra_xml_templates/submission_template.xml</pre>
</div>
<p>Produces <tt class="docutils literal"><span class="pre">sample.xml</span></tt>, <tt class="docutils literal"><span class="pre">study.xml</span></tt>, <tt class="docutils literal"><span class="pre">submission.xml</span></tt> from the tab-delimited text files.</p>
<ol class="arabic" start="2">
<li><p class="first">Submission of Experiment and Run Metadata.</p>
<blockquote>
<dl class="docutils">
<dt><strong>Input:</strong></dt>
<dd><ol class="first last loweralpha simple">
<li><tt class="docutils literal"><span class="pre">experiment.txt</span></tt> - tabular metadata about the contents of each combination of library and sff file.</li>
<li><tt class="docutils literal"><span class="pre">data</span></tt> - directory of multiple sff files containing the actual sequence data</li>
</ol>
</dd>
<dt><strong>Output:</strong></dt>
<dd><ol class="first last loweralpha simple">
<li><tt class="docutils literal"><span class="pre">experiment.xml</span></tt> - xml-format metadata about the set of experiments described in <tt class="docutils literal"><span class="pre">library.txt</span></tt></li>
<li><tt class="docutils literal"><span class="pre">run.xml</span></tt> - xml-format metadata about each run, i.e. the association betweena specific member of a pool and a specific xml file.</li>
<li><tt class="docutils literal"><span class="pre">data.tgz</span></tt> - a gzipped tar archive containing individual sff files for each SRA RUN (see the Questions above if you are unclear on the distinction between the SRA RUN concept and the concept of an instrument run).</li>
</ol>
</dd>
</dl>
</blockquote>
</li>
</ol>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="step-1-get-fasta-and-qual-from-sff-files">
<h3>Step 1: Get fasta and qual from sff files<a class="headerlink" href="#step-1-get-fasta-and-qual-from-sff-files" title="Permalink to this headline">¶</a></h3>
<p>This step converts the sff files into text formats that are more usable. Note that in this example the .fna and .qual files are already in there to eliminate the requirement for the off-machine apps, so they will simply be overwritten with identical files by this script. If you do not have these apps, please skip to the Step 2.</p>
<div class="highlight-python"><pre>process_sff.py -i .</pre>
</div>
<p><strong>Output:</strong> Makes .fna and .qual files for each sff file.</p>
</div>
<div class="section" id="step-2-produce-valid-mapping-file-for-library-demultiplexing">
<h3>Step 2: Produce valid mapping file for library demultiplexing<a class="headerlink" href="#step-2-produce-valid-mapping-file-for-library-demultiplexing" title="Permalink to this headline">¶</a></h3>
<p>This step converts the input experiment file into separate mapping files for each combination of STUDY and RUN_PREFIX (separating by run prefix is necessary when the same barcodes are used in different runs). This allows demultiplexing of the separate studies, which will then be sent in as separate submissions, and of the different barcoded plates, which will be demultiplexed separately.</p>
<p>Note: the LINKER field is no longer required in the spreadsheet.</p>
<div class="highlight-python"><pre>sra_spreadsheet_to_map_files.py -i experiment.txt</pre>
</div>
<p><strong>Output:</strong> Produces valid mapping files per 454 plate: <tt class="docutils literal"><span class="pre">fierer_hand_study_E86FECS.map</span></tt> and <tt class="docutils literal"><span class="pre">fierer_hand_study_FA6P1OK.map</span></tt></p>
</div>
<div class="section" id="step-3-demultiplex-libraries">
<h3>Step 3: Demultiplex libraries<a class="headerlink" href="#step-3-demultiplex-libraries" title="Permalink to this headline">¶</a></h3>
<p>This step assigns each sequence to a library, dropping low-quality sequences and producing a log explaining why specific sequences were dropped.</p>
<p>NOTE: The SRA requests that you deposit ALL your sequence data, including bad reads, unless there is an IRB reason not to do so (i.e. human contamination). Therefore the quality and length filtering should be turned off.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">split_libraries</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p><strong>Output:</strong> Shows you the help for <a class="reference external" href="./scripts/split_libraries.html">split_libaries.py</a></p>
<div class="highlight-python"><pre>split_libraries.py -s 5 -l 30 -L 1000 -b 12 -H 1000 -M 100 -a 1000 -f sff_files/E86FECS01.fna,sff_files/E86FECS02.fna -q sff_files/E86FECS01.qual,sff_files/E86FECS02.qual -m fierer_hand_study_E86FECS.map -o E86FECS_demultiplex

split_libraries.py -s 5 -l 50 -L 1000 -b 12 -H 1000 -M 100 -a 1000 -f sff_files/FA6P1OK01.fna,sff_files/FA6P1OK02.fna -q sff_files/FA6P1OK01.qual,sff_files/FA6P1OK02.qual -m fierer_hand_study_FA6P1OK.map -o FA6P1OK_demultiplex -r</pre>
</div>
<p><strong>Output:</strong> Produces two files: <tt class="docutils literal"><span class="pre">seqs.fna</span></tt> with valid sequences assigned to samples via barcodes, and <tt class="docutils literal"><span class="pre">split_libraries_log.txt</span></tt> with info about which sequences failed QC. The parameters above are essentially turning off the default quality filters and require an average qual score of at least 5, a minimum sequence length of 30 (basically just the primer_barcode), a maximum sequence length of 1000, max homopolymer run of 1000, up to 100 errors in the primer, etc. to let everything through, and specify that we are using 12-base barcodes (turning off the Golay error-correction, which would be specified with -b golay_12), specify the (comma-delimited) paths to the fasta and mapping files (note: no spaces are allowed around the commas), and finally specify the mapping file as one of the map files we produced in step 2 (taking care to use the right map file for each run). Note: you can turn off the quality filtering steps if you want to make sure that all the sequences appear in the output. The -r True flag removes unassigned sequences from the fasta file and, if added, will make the analysis run substantially faster. In this case we use -r on the second run but not on the first run because all the reads on the first run were from this study, but only some of the reads from the second run were from this study, and we can&#8217;t tell a valid read from another study apart from a bad read from this one.</p>
</div>
<div class="section" id="step-4-reduce-sequence-complexity-by-picking-otus-with-cd-hit">
<h3>Step 4: Reduce sequence complexity by picking OTUs with cd-hit<a class="headerlink" href="#step-4-reduce-sequence-complexity-by-picking-otus-with-cd-hit" title="Permalink to this headline">¶</a></h3>
<p>This step reduces the number of sequences to do the human screen by picking OTUs at 95%. We make the simplifying assumption that sequences that are identical over the first 100 bases will fall into the same OTU.</p>
<p>Note: this step requires that you have cd-hit installed.</p>
<div class="highlight-python"><pre>pick_otus.py -M 4000 -n 100 -s 0.95 -o E86FECS_demultiplex -i E86FECS_demultiplex/seqs.fna</pre>
</div>
<p><strong>Output:</strong> Produces two files: <tt class="docutils literal"><span class="pre">E86FECS_demultiplex/seqs_otus.txt</span></tt> and <tt class="docutils literal"><span class="pre">E86FECS_demultiplex/seqs_otus.log</span></tt> (which have the OTUs and the log file describing the analysis respectively).</p>
<div class="highlight-python"><pre>pick_otus.py -M 4000 -n 100 -s 0.95 -o FA6P1OK_demultiplex/ -i FA6P1OK_demultiplex/seqs.fna</pre>
</div>
<p>Repeat the same procedure for the other library.</p>
</div>
<div class="section" id="step-5-pick-a-representative-sequence-for-each-otu">
<h3>Step 5: Pick a representative sequence for each OTU<a class="headerlink" href="#step-5-pick-a-representative-sequence-for-each-otu" title="Permalink to this headline">¶</a></h3>
<p>This step gets the actual sequences for each OTU picked in Step 4.</p>
<div class="highlight-python"><pre>pick_rep_set.py -i E86FECS_demultiplex/seqs_otus.txt -f E86FECS_demultiplex/seqs.fna</pre>
</div>
<p><strong>Output:</strong> Produces <tt class="docutils literal"><span class="pre">E86FECS_demultiplex/seqs.fna_rep_set.fasta</span></tt></p>
<div class="highlight-python"><pre>pick_rep_set.py -i FA6P1OK_demultiplex/seqs_otus.txt -f FA6P1OK_demultiplex/seqs.fna</pre>
</div>
<p><strong>Output:</strong> Produces <tt class="docutils literal"><span class="pre">FA6P1OK_demultiplex/seqs.fna_rep_set.fasta</span></tt></p>
</div>
<div class="section" id="step-6-blast-the-representative-set-sequences-against-95-otus-in-greengenes-to-eliminate-sequences-that-aren-t-really-16s-rrna">
<h3>Step 6: Blast the representative set sequences against 95% OTUs in greengenes to eliminate sequences that aren&#8217;t really 16S rRNA<a class="headerlink" href="#step-6-blast-the-representative-set-sequences-against-95-otus-in-greengenes-to-eliminate-sequences-that-aren-t-really-16s-rrna" title="Permalink to this headline">¶</a></h3>
<p>This step performs a human/contaminant screen the &#8220;safe&#8221; way by identifying and excluding sequences that aren&#8217;t 16S rRNA.</p>
<div class="highlight-python"><pre>exclude_seqs_by_blast.py -d greengenes_unaligned.fasta-OTUs_at_0.05.fasta -i E86FECS_demultiplex/seqs.fna_rep_set.fasta -W 10 -p 0.25 -o E86FECS_demultiplex/blast_results -e 1e-20</pre>
</div>
<p>We are using blastn with a word size of 10, requiring 25% coverage of the sequence, and an E-value of 1e-20. Our tests suggest that this is sufficient to screen out human genomic reads (the human 18S sequence hits bacterial 16S with E-value between 1e-18 and 1e-10 depending on lineage).</p>
<p><strong>Output:</strong> This produces a bunch of log files and output; the file of screened seqs (i.e. that failed to hit a known 16S rRNA with even relaxed criteria)</p>
<p>Repeat the same procedure for the other library</p>
<div class="highlight-python"><pre>exclude_seqs_by_blast.py -d greengenes_unaligned.fasta-OTUs_at_0.05.fasta -i FA6P1OK_demultiplex/seqs.fna_rep_set.fasta -W 10 -p 0.25 -o FA6P1OK_demultiplex/blast_results -e 1e-20</pre>
</div>
</div>
<div class="section" id="step-7-make-per-library-files-of-good-ids-to-pass-to-sfffile">
<h3>Step 7: Make per-library files of &#8220;good&#8221; ids to pass to sfffile<a class="headerlink" href="#step-7-make-per-library-files-of-good-ids-to-pass-to-sfffile" title="Permalink to this headline">¶</a></h3>
<p>This step maps the ids of the representative set back onto the ids of the OTUs they came from so that we can get all the members of the OTUs that had a representative that matched a known 16S rRNA.</p>
<div class="highlight-python"><pre>make_library_id_lists.py -i E86FECS_demultiplex/seqs.fna -s E86FECS_demultiplex/blast_results.screened -u E86FECS_demultiplex/seqs_otus.txt -o E86FECS_demultiplex/per_lib_info</pre>
</div>
<p><strong>Output:</strong> This makes a new directory called &#8220;E86FECS_demultiplex/per_lib_idlists&#8221;, which contains a separate file with an id list for each library.</p>
<div class="highlight-python"><pre>make_library_id_lists.py -i FA6P1OK_demultiplex/seqs.fna -s FA6P1OK_demultiplex/blast_results.screened -u FA6P1OK_demultiplex/seqs_otus.txt -o FA6P1OK_demultiplex/per_lib_info</pre>
</div>
<p><strong>Output:</strong> This makes a new directory called &#8220;FA6P1OK_demultiplex/per_lib_idlists&#8221;, which contains a separate file with an id list for each library.</p>
</div>
<div class="section" id="step-8-use-sfffile-to-make-per-library-sff-files">
<h3>Step 8: Use sfffile to make per-library sff files<a class="headerlink" href="#step-8-use-sfffile-to-make-per-library-sff-files" title="Permalink to this headline">¶</a></h3>
<p>This step takes the good lists of ids from step 7 and extracts a separate sff file for each of those lists.</p>
<div class="highlight-python"><pre>make_per_library_sff.py -i sff_files/E86FECS01.sff,sff_files/E86FECS02.sff -l E86FECS_demultiplex/per_lib_info/

make_per_library_sff.py -i sff_files/FA6P1OK01.sff,sff_files/FA6P1OK02.sff -l FA6P1OK_demultiplex/per_lib_info/</pre>
</div>
</div>
<div class="section" id="step-9-use-sfffile-to-quality-trim-the-barcodes-primers-and-linkers">
<h3>Step 9: Use sfffile to quality-trim the barcodes, primers and linkers<a class="headerlink" href="#step-9-use-sfffile-to-quality-trim-the-barcodes-primers-and-linkers" title="Permalink to this headline">¶</a></h3>
<p>The SRA requires that the user reset the left trim in the sff file to eliminate the technical reads (barcode, primer, linker if present). This means figuring out the length of the technical parts of the read, the length of the current read, writing out a text file with the per-id info, and running sfffile to reset the read lengths.</p>
<div class="highlight-python"><pre>trim_sff_primers.py -m fierer_hand_study_E86FECS.map -l E86FECS_demultiplex/per_lib_info/

trim_sff_primers.py -m fierer_hand_study_FA6P1OK.map -l FA6P1OK_demultiplex/per_lib_info/</pre>
</div>
</div>
<div class="section" id="step-10-move-files-around-and-make-archive-which-will-be-automated-in-the-future-releases">
<h3>Step 10: Move files around and make archive, which will be automated in the future releases<a class="headerlink" href="#step-10-move-files-around-and-make-archive-which-will-be-automated-in-the-future-releases" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>mkdir per_run_sff
mkdir per_run_sff/FA6P1OK
mkdir per_run_sff/E86FECS
cp FA6P1OK_demultiplex/per_lib_info/*.sff per_run_sff/FA6P1OK/
cp E86FECS_demultiplex/per_lib_info/*.sff per_run_sff/E86FECS/
mv per_run_sff/E86FECS/Unassigned.sff per_run_sff/E86FECS/fierer_hand_study_default_E86FECS.sff
mv per_run_sff/FA6P1OK/Unassigned.sff per_run_sff/FA6P1OK/fierer_hand_study_default_FA6P1OK.sff
tar cvfz all_hand_sff_data.tgz per_run_sff/</pre>
</div>
</div>
<div class="section" id="step-11-finally-make-the-second-stage-submission">
<h3>Step 11: Finally, make the second-stage submission<a class="headerlink" href="#step-11-finally-make-the-second-stage-submission" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>make_sra_submission.py -u submission_second_stage.txt -e experiment.txt -s per_run_sff --template_study_fp ~/Qiime/support_files/sra_xml_templates/study_template.xml --template_sample_fp ~/Qiime/support_files/sra_xml_templates/sample_template.xml -template_submission_fp ~/Qiime/support_files/sra_xml_templates/submission_template.xml</pre>
</div>
<p><strong>Output:</strong> Produces files: <tt class="docutils literal"><span class="pre">experiment.xml</span></tt>, <tt class="docutils literal"><span class="pre">run.xml</span></tt> and  <tt class="docutils literal"><span class="pre">submission_second_stage.xml</span></tt></p>
<p>...and the process is complete.</p>
<p>Note: SRA prefers you give the individual files more meaningful names than the defaults, so suggest not just using generic names like experiment etc.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

    
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">SRA Submission</a><ul>
<li><a class="reference external" href="#introduction">Introduction</a></li>
<li><a class="reference external" href="#philosophy-of-this-document-and-the-accompanying-code">Philosophy of this Document and the Accompanying Code</a></li>
<li><a class="reference external" href="#overview-of-the-submission-process">Overview of the Submission Process</a></li>
<li><a class="reference external" href="#example">Example</a><ul>
<li><a class="reference external" href="#step-1-get-fasta-and-qual-from-sff-files">Step 1: Get fasta and qual from sff files</a></li>
<li><a class="reference external" href="#step-2-produce-valid-mapping-file-for-library-demultiplexing">Step 2: Produce valid mapping file for library demultiplexing</a></li>
<li><a class="reference external" href="#step-3-demultiplex-libraries">Step 3: Demultiplex libraries</a></li>
<li><a class="reference external" href="#step-4-reduce-sequence-complexity-by-picking-otus-with-cd-hit">Step 4: Reduce sequence complexity by picking OTUs with cd-hit</a></li>
<li><a class="reference external" href="#step-5-pick-a-representative-sequence-for-each-otu">Step 5: Pick a representative sequence for each OTU</a></li>
<li><a class="reference external" href="#step-6-blast-the-representative-set-sequences-against-95-otus-in-greengenes-to-eliminate-sequences-that-aren-t-really-16s-rrna">Step 6: Blast the representative set sequences against 95% OTUs in greengenes to eliminate sequences that aren&#8217;t really 16S rRNA</a></li>
<li><a class="reference external" href="#step-7-make-per-library-files-of-good-ids-to-pass-to-sfffile">Step 7: Make per-library files of &#8220;good&#8221; ids to pass to sfffile</a></li>
<li><a class="reference external" href="#step-8-use-sfffile-to-make-per-library-sff-files">Step 8: Use sfffile to make per-library sff files</a></li>
<li><a class="reference external" href="#step-9-use-sfffile-to-quality-trim-the-barcodes-primers-and-linkers">Step 9: Use sfffile to quality-trim the barcodes, primers and linkers</a></li>
<li><a class="reference external" href="#step-10-move-files-around-and-make-archive-which-will-be-automated-in-the-future-releases">Step 10: Move files around and make archive, which will be automated in the future releases</a></li>
<li><a class="reference external" href="#step-11-finally-make-the-second-stage-submission">Step 11: Finally, make the second-stage submission</a></li>
</ul>
</li>
</ul>
</li>
</ul>



            <h4>Previous topic</h4>
            <p class="topless"><a href="doc_special_purpose.html"
                                  title="previous chapter">Special-Purpose Tutorials</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="developer/reporting_and_fixing_bugs.html"
                                  title="next chapter">Report and fixing bugs</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/doc_sra_submission.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="developer/reporting_and_fixing_bugs.html" title="Report and fixing bugs"
             >next</a> |</li>
        <li class="right" >
          <a href="doc_special_purpose.html" title="Special-Purpose Tutorials"
             >previous</a> |</li>
        <li><a href="index.html">Home</a> &raquo;</li>
          <li><a href="documentation.html" >QIIME Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, QIIME Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.3.
    </div>
  </body>
</html>